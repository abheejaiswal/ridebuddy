<%- include('partials/sidebar') %>

<!-- Before </body> -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<style>
  /* Improved Table Styles */
  .table-hover tbody tr:hover {
    background-color: #f8fafc !important;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
    transition: all 0.2s ease;
  }

  .table-striped tbody tr:nth-of-type(odd) {
    background-color: #f9f9f9;
  }

  .thead-light th{
    background-color: #f8f9fa;
    font-weight: 600;
    color: #495057;
    letter-spacing: 0.5px;
    padding: 12px 16px;
    border-bottom: 2px solid #dee2e6;
  }

  .table td, .table th {
    vertical-align: middle;
    padding: 12px 16px;
    font-size: 14px;
    border-top: 1px solid #eceff1;
  }

  /* Card Improvements */
  .card {
    border: none;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(0, 0, 0, 0.09);
  }

  .card-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    padding: 15px 20px;
  }

  .card-header h6 {
    font-weight: 600;
    font-size: 16px;
    color: #2c3e50;
    margin: 0;
  }

  /* Buttons */
  .btn-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
  }

  .btn-sm i {
    font-size: 12px;
  }

  /* Main Heading */
  .text-gray-800 {
    font-weight: 600;
    font-size: 1.5rem;
    color: #2c3e50;
    margin-bottom: 1rem;
  }

  /* Modal Improvements */
  .modal-content {
    border: none;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
  }

  .modal-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid #e9ecef;
    padding: 1rem 1.5rem;
  }

  .modal-title {
    font-weight: 600;
    color: #2c3e50;
  }

  .modal-body {
    padding: 1.5rem;
  }

  .modal-footer {
    border-top: 1px solid #e9ecef;
    padding: 1rem 1.5rem;
    background-color: #f8f9fa;
  }

  /* Pagination */
  .pagination .page-item.active .page-link {
    background-color: #007bff;
    border-color: #007bff;
  }

  .pagination .page-link {
    color: #495057;
    border: 1px solid #dee2e6;
    margin: 0 3px;
    border-radius: 4px !important;
  }

  /* Action Buttons */
  .action-buttons .btn {
    margin-right: 5px;
    width: 30px;
    height: 30px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  /* Responsive Adjustments */
  @media (max-width: 768px) {
    .table-responsive {
      border: 1px solid #dee2e6;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .card-header {
      flex-direction: column;
      align-items: flex-start;
    }
  }
</style>

<div id="content-wrapper" class="d-flex flex-column">
  <div id="content">
    <%- include('partials/header') %>

    <div class="container-fluid" id="container-wrapper">
      <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Fare Rules</h1>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addPaymentModal"style="background-color:green;margin-top:10px;">
          <i class="fas fa-plus me-2"></i> Add New Rule
        </button>
      </div>

      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h6 class="m-0 font-weight-bold">All Fare Rules</h6>
              <div class="input-group" style="width: 250px;">
                <input type="text" id="searchInput" class="form-control form-control-sm" placeholder="Search..." onkeyup="filterTable()">
                <button class="btn btn-outline-secondary btn-sm" type="button">
                  <i class="fas fa-search"></i>
                </button>
              </div>
            </div>

            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover table-striped align-middle">
                  <thead class="thead-light">
                    <tr>
                      <th>#</th> 
                      <th>Min Km</th>
                      <th>Max Km</th>
                      <th>Rate Per Km</th>
                      <th>Created At</th>
                      <th class="text-end">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% if (documents && documents.length > 0) { %>
                      <% documents.forEach((payment, index) => { %>
                        <tr>
                          <td><%= index + 1 %></td> 
                          <td><%= payment.min_km %></td>  
                          <td><%= payment.max_km %></td>
                          <td><%= payment.rate_per_km %></td>
                          <td><%= new Date(payment.created_at).toLocaleString() %></td>
                          <td class="text-end action-buttons">
                            <!-- Edit Button -->
                            <button type="button" class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#editModal_<%= payment.id %>">
                              <i class="fas fa-edit"></i>
                            </button>
                            
                            <!-- Delete Button -->
                            <form action="/fare-rules/delete/<%= payment.id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this record?');" style="display: inline;">
                              <button type="submit" class="btn btn-sm btn-danger">
                                <i class="fas fa-trash-alt"></i>
                              </button>
                            </form>
                          </td>
                        </tr>
                      <% }) %>
                    <% } else { %>
                      <tr>
                        <td colspan="6" class="text-center py-4 text-muted">
                          <i class="fas fa-info-circle me-2"></i> No fare rules found
                        </td>
                      </tr>
                    <% } %>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="card-footer d-flex flex-column flex-md-row justify-content-between align-items-center bg-light">
              <div class="mb-2 mb-md-0">
                <span class="text-muted small">Showing 1 to <%= documents.length %> of <%= documents.length %> entries</span>
              </div>
              <nav>
                <ul class="pagination pagination-sm mb-0">
                  <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
                  <li class="page-item active"><a class="page-link" href="#">1</a></li>
                  <li class="page-item"><a class="page-link" href="#">2</a></li>
                  <li class="page-item"><a class="page-link" href="#">Next</a></li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%- include('partials/footer') %>
  </div>
</div>

<!-- Edit Modals -->
<% documents.forEach((payment) => { %>
<div class="modal fade" id="editModal_<%= payment.id %>" tabindex="-1" aria-labelledby="editModalLabel_<%= payment.id %>" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-success bg-opacity-10">
        <h5 class="modal-title text-light" id="editModalLabel_<%= payment.id %>">Edit Fare Rule</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
    <form action="/fare-rules/update/<%= payment.id %>" method="POST">
        <div class="modal-body">
          <div class="mb-3">
            <label for="minKm_<%= payment.id %>" class="form-label">Minimum Kilometers</label>
            <input type="number" class="form-control" id="minKm_<%= payment.id %>" name="min_km" value="<%= payment.min_km %>"   min="0"
       max="999"
       maxlength="3"
       oninput="this.value = this.value.slice(0, 3); if (this.value > 999) this.value = 999;"
       required>
          </div>
          
          <div class="mb-3">
            <label for="maxKm_<%= payment.id %>" class="form-label">Maximum Kilometers</label>
            <input type="number" class="form-control" id="maxKm_<%= payment.id %>" name="max_km" value="<%= payment.max_km %>"min="1"max="999"maxlength="3"oninput="this.value = this.value.slice(0, 3); if (this.value > 999) this.value = 999;"required>
          </div>
          
          <div class="mb-3">
            <label for="ratePerKm_<%= payment.id %>" class="form-label">Rate Per Kilometer</label>
            <input type="number" step="0.01" class="form-control" id="ratePerKm_<%= payment.id %>" name="rate_per_km" value="<%= payment.rate_per_km %>" min="0"
       max="999.99"
       oninput="if (this.value > 999.99) this.value = 999.99;" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>
<% }) %>

<!-- Add Payment Modal -->
<div class="modal fade" id="addPaymentModal" tabindex="-1" aria-labelledby="addPaymentModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-success bg-opacity-10">
        <h5 class="modal-title text-light" id="addPaymentModalLabel">Add New Fare Rule</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form action="/fare-rules/add" method="POST">
        <div class="modal-body">
          <div class="mb-3">
            <label for="minKm" class="form-label">Minimum Kilometers</label>
            <input type="number" class="form-control" id="minKm" name="min_km" "min="1"max="999"maxlength="3"oninput="this.value = this.value.slice(0, 3); if (this.value > 999) this.value = 999required>
          </div>
          <div class="mb-3">
            <label for="maxKm" class="form-label">Maximum Kilometers</label>
            <input type="number" class="form-control" id="maxKm" name="max_km" min="1"max="999"maxlength="3"oninput="this.value = this.value.slice(0, 3); if (this.value > 999) this.value = 999;"required>
          </div>
          <div class="mb-3">
            <label for="ratePerKm" class="form-label">Rate Per Kilometer</label>
            <input type="number" step="0.01" class="form-control" id="ratePerKm" name="rate_per_km"  min="0"
       max="999.99"
       oninput="if (this.value > 999.99) this.value = 999.99;"required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success">Add Rule</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Search Script -->
<script>
  function filterTable() {
    const input = document.getElementById('searchInput');
    const filter = input.value.toLowerCase();
    const rows = document.querySelectorAll("tbody tr");

    rows.forEach(row => {
      const text = row.textContent.toLowerCase();
      row.style.display = text.includes(filter) ? '' : 'none';
    });
  }
</script>

<!-- jQuery and DataTables Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

<!-- Initialize DataTable -->
<script>
  $(document).ready(function() {
    $('#vehicleTable').DataTable({
      "pageLength": 10,
      "lengthChange": true,
      "ordering": true,
      "searching": true,
      "info": true,
      "language": {
        "search": "Search:",
        "lengthMenu": "Show _MENU_ entries",
        "info": "Showing _START_ to _END_ of _TOTAL_ entries",
        "paginate": {
          "previous": "Previous",
          "next": "Next"
        }
      }
    });
  });
</script>
